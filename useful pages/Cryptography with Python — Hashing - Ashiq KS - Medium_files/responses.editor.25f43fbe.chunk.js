(window.webpackJsonp=window.webpackJsonp||[]).push([[55],{"./src/apollo/error.ts":function(e,t,n){"use strict";n.d(t,"b",(function(){return s})),n.d(t,"a",(function(){return o}));var s=function(e){if(!e)return!1;var t=e.graphQLErrors;return!!t&&!!t.find((function(e){return 2===e.type&&1===e.path.length}))},o=function(e){if(!e)return!1;var t=e.graphQLErrors;return!!t&&!!t.find((function(e){var t;return"RESPONSE_LOCKED"===(null===(t=e.extensions)||void 0===t?void 0:t.code)}))}},"./src/components/responses/editor/InlineResponseEditor.tsx":function(e,t,n){"use strict";n.r(t),n.d(t,"InlineResponseEditor",(function(){return be}));var s=n("./node_modules/@babel/runtime/helpers/typeof.js"),o=n.n(s),r=n("./node_modules/@babel/runtime/helpers/slicedToArray.js"),a=n.n(r),i=n("./node_modules/react/index.js"),c=n("./src/apollo/error.ts"),l=n("./src/components/editor/EditorActions.tsx"),p=n("./src/components/responses/ResponsesContext.tsx"),u=n("./src/components/session/useFlag.tsx"),d=n("./src/framework/source/index.ts"),m=n("./src/util/useragent.ts"),f=n("./src/framework/design-system/components/index.ts"),b=n("./src/framework/design-system/type/index.ts"),g=n("./src/util/routes.ts"),E=function(e){var t=e.message||"The author has closed discussion for this story.";return i.createElement(f.b,{backgroundColor:"BASE_NORMAL",display:"flex",flexDirection:"row",alignItems:"center",padding:"16px"},i.createElement(b.a,{scale:"M",tag:"span",color:"DARKER"},t," ",i.createElement(f.t,{href:Object(g.eb)(),inline:!0,linkStyle:"OBVIOUS"},"Learn more.")))},h=n("./src/components/metabar/OpenInApp.tsx"),x=function(e){var t=e.postId;return i.createElement(f.b,{backgroundColor:"BASE_NORMAL",display:"flex",flexDirection:"row",justifyContent:"space-between",alignItems:"center",padding:"24px"},i.createElement(b.a,{scale:"S",color:"DARKER"},"To respond to this story,",i.createElement("br",null),"get the free Medium app."),i.createElement(f.b,null,i.createElement(h.a,{isButton:!0,appEntry:"responsesSidebar",postId:t})))},v=n("./node_modules/@babel/runtime/helpers/toConsumableArray.js"),y=n.n(v),O=n("./node_modules/@babel/runtime/helpers/defineProperty.js"),R=n.n(O),j=n("./node_modules/@babel/runtime/helpers/taggedTemplateLiteral.js"),I=n.n(j),S=n("./node_modules/@apollo/react-components/lib/react-components.esm.js"),P=n("./node_modules/graphql-tag/src/index.js"),w=n.n(P),_=n("./src/components/responses/ResponsesSidebar.tsx"),C=n("./src/components/responses/SimpleResponse.tsx");function N(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,s)}return n}function k(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?N(Object(n),!0).forEach((function(t){R()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):N(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function L(){var e=I()(["\n  mutation publishPostResponse($inResponseToPostId: ID!, $deltas: [Delta!]!) {\n    publishPostResponse(inResponseToPostId: $inResponseToPostId, deltas: $deltas) {\n      itemType {\n        __typename\n        ... on StreamItemPostSimpleResponse {\n          ...SimpleResponse_simpleResponse\n        }\n      }\n    }\n  }\n  ","\n"]);return L=function(){return e},e}var T=w()(L(),C.b),D=function(e){var t=e.children,n=e.postId;return i.createElement(S.a,{mutation:T,update:function(e,t){var s=function(e,t){var n,s=null==t||null===(n=t.post)||void 0===n?void 0:n.postResponses;if(!(null==s?void 0:s.responsesConnection)||null===(null==s?void 0:s.count)||!e.data)return null;var o=e.data.publishPostResponse,r=s.responsesConnection.stream;return{post:k({},t.post,{postResponses:k({},s,{count:s.count+1,responsesConnection:k({},s.responsesConnection,{stream:[o].concat(y()(r))})})})}}(t,e.readQuery({query:_.a,variables:{postId:n,postResponsesPaging:{limit:10}}}));null!==s&&e.writeQuery({query:_.a,data:s,variables:{postId:n,postResponsesPaging:{limit:10}}})}},(function(e,n){return t({publishResponse:e,loading:n.loading,error:n.error})}))};function A(){var e=I()(["\n  mutation savePostResponse($inResponseToPostId: ID!, $deltas: [Delta!]!) {\n    savePostResponse(inResponseToPostId: $inResponseToPostId, deltas: $deltas) {\n      ... on Post {\n        id\n      }\n    }\n  }\n"]);return A=function(){return e},e}var M,B=w()(A()),H=function(e){var t=e.children;return i.createElement(S.a,{mutation:B},(function(e){return t({saveResponse:e})}))},$=n("./node_modules/@babel/runtime/regenerator/index.js"),W=n.n($),z=n("./node_modules/react-redux/es/index.js"),Q=n("./node_modules/slate/dist/index.es.js"),U=n("./node_modules/slate-react/dist/index.es.js"),q=n("./src/components/editor/EditorBody.tsx");!function(e){e.FULL="web-full",e.INLINE_HOMEPAGE_TOP="web-inline-homepage-top",e.INLINE_POST_RESPONSE="web-inline-post-response",e.INLINE_NEWSLETTER="web-inline-newsletter",e.INLINE_QUOTE_RESPONSES="web-inline-quote-responses"}(M||(M={}));var F=n("./src/components/editor/EditorWrapper.tsx"),K=n("./src/components/editor/editorHelpers.tsx"),V=n("./src/components/editor/useMediumEditor.tsx"),G=n("./src/components/navigation/Redirect.tsx"),J=n("./src/components/ui/PopoverMenu.tsx"),X=n("./src/framework/style/index.ts"),Z=n("./src/styles/zIndex.ts"),Y=n("./src/svg/overflow-dots-filled-25px.svg"),ee=function(e){return{cursor:"pointer",border:0,fill:e.baseColor.fill.light,":hover":{fill:e.baseColor.fill.dark}}},te=function(e){var t=e.saveResponse,n=Object(X.useCx)();return i.createElement(f.I,null,(function(e){var s=e.isVisible,o=e.toggle,r=e.hide;return i.createElement(f.w,{isVisible:s,hide:r,customZIndex:Z.a.responseSidebarPopover,noArrow:!0,placement:"bottom-end",popoverRenderFn:function(){return i.createElement(J.a,null,i.createElement(J.b,null,i.createElement(f.t,{onClick:t,"data-testid":"saveResponseMenuItem"},"Make this response a story")))}},i.createElement(f.t,{onClick:o,className:n(ee),"data-testid":"editorMenu"},i.createElement(Y.a,null)))}))},ne=function(e){var t=e.responseContent,n=e.setResponseContent,s=e.setIsEmpty,o=e.isEditorOpen,r=Object(X.useCx)();return i.createElement("textarea",{placeholder:"What are your thoughts?",value:t,onChange:function(e){var t=e.target.value;s(!t),n(t)},className:r({width:"100%",padding:"14px",resize:"none",minHeight:o?"100px":"0",height:o?"auto":"47px",fontFamily:"inherit",fontSize:"inherit",lineHeight:"inherit",outline:"0",border:"0"})})},se=function(){return Math.round(65535*Math.random()).toString(16).padStart(4,"0")},oe=n("./src/components/session/useViewer.tsx"),re=n("./src/components/susi/SusiClickable.tsx"),ae=n("./src/components/user/UserAvatar.tsx"),ie=n("./src/framework/design-system/components/Box.tsx"),ce=n("./src/framework/reporter/index.ts");function le(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,s)}return n}function pe(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?le(Object(n),!0).forEach((function(t){R()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):le(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var ue=function(){return{"& button":{border:"none"}}},de=function(e){var t={display:"flex",alignSelf:"flex-end",padding:"0 14px"};return pe({},t,e?{transition:"opacity ".concat("400ms",", max-height ").concat("400ms"),opacity:1,maxHeight:"100px"}:{transition:"opacity ".concat("400ms",", max-height ").concat("400ms"),opacity:0,maxHeight:0})},me=function(e){return e?{transition:"min-height ".concat("400ms"),minHeight:"100px"}:{transition:"min-height ".concat("400ms"),minHeight:"15px"}},fe=function(e){var t=e.postId,n=e.isPublishingResponse,s=e.publishResponse,o=e.saveResponse,r=Object(X.useCx)(),c=Object(ce.c)(),u=Object(d.d)(),E=Object(m.b)(navigator.userAgent),h=Object(l.b)().value,x=Object(V.d)([V.e]),v=x.editor,y=x.renderLeaf,O=x.renderElement,R=i.useState(!1),j=a()(R,2),I=j[0],S=j[1],P=i.useState(!0),w=a()(P,2),_=w[0],C=w[1],N=i.useState(""),k=a()(N,2),L=k[0],T=k[1],D=i.useState(void 0),A=a()(D,2),B=A[0],H=A[1],$=Object(z.f)((function(e){return e.config.authDomain})),J=Object(oe.b)(),Z=i.useCallback((function(){S(!1),E?T(""):Object(K.b)(v)}),[S]);i.useEffect((function(){C(Q.c.string(v).length<=0)}),[h]),i.useEffect((function(){I&&U.b.focus(v)}),[I]);var Y,ee,le=i.useContext(p.a).setIsSavingResponse,fe=function(e){le(!0);var n=E?function(e){var t=[],n=e.split("\n");return t.push({type:8,index:0,section:{name:se(),startIndex:0}}),n.forEach((function(e,n){t.push({type:1,paragraph:{markups:[],name:se(),text:e,type:1},verifySameName:!1,index:n})})),t}(L):Object(K.c)(v);return e({variables:{inResponseToPostId:t,deltas:n}}).then((function(){return c.event("inlineEditor.publish",{postId:t,context:M.INLINE_POST_RESPONSE,source:u}),le(!1),Z()}))};return B?(c.event("inlineEditor.expand",{postId:t,context:M.INLINE_POST_RESPONSE,source:u}),i.createElement(G.a,{to:Object(g.ub)($,B)})):i.createElement(ie.a,{marginBottom:"20px",padding:"0 24px"},i.createElement("div",{className:r({backgroundColor:"white",boxShadow:"0px 2px 8px rgba(0,0,0,0.12)",borderRadius:"4px",display:"flex",flexDirection:"column",overflow:"hidden",paddingTop:I?"14px":"0",paddingBottom:I?"14px":"0",transition:"padding-top ".concat("400ms",", padding-bottom ").concat("400ms")})},J&&i.createElement("div",{className:r((Y=I,ee={display:"flex",alignItems:"center",justifyContent:"space-between",position:"relative",padding:"0 14px"},pe({},ee,Y?{transition:"opacity ".concat("400ms",", max-height ").concat("400ms",", margin-bottom ").concat("400ms"),opacity:1,maxHeight:"100px",marginBottom:"6px"}:{transition:"opacity ".concat("300ms",", max-height ").concat("300ms",", margin-bottom ").concat("300ms"),opacity:0,maxHeight:0,marginBottom:"0"})))},i.createElement(ie.a,{display:"flex",alignItems:"center"},i.createElement(ae.d,{scale:"XS",user:J}),i.createElement(ie.a,{marginLeft:"12px"},i.createElement(b.a,{scale:"M",color:"DARKER"},J.name))),I&&i.createElement(te,{saveResponse:function(){return function(e){var n;return W.a.async((function(s){for(;;)switch(s.prev=s.next){case 0:return s.next=2,W.a.awrap(e({variables:{inResponseToPostId:t,deltas:Object(K.c)(v)}}));case 2:n=s.sent,H(n.data.savePostResponse.id);case 4:case"end":return s.stop()}}))}(o)}})),i.createElement(ie.a,{display:"flex",flexDirection:"column"},J?i.createElement("div",{className:r(me(I)),onClick:function(){return S(!0)},role:"button"},E?i.createElement(ne,{responseContent:L,setIsEmpty:C,setResponseContent:T,isEditorOpen:I}):i.createElement(ie.a,{padding:"14px"},i.createElement(F.a,{editor:v},i.createElement(q.a,{renderLeaf:y,renderElement:O,placeholder:"What are your thoughts?"})))):i.createElement(re.a,{operation:"register",susiEntry:"respond_sidebar"},i.createElement(ie.a,{padding:"14px"},i.createElement(b.a,{scale:"M",color:"LIGHTER"},"What are your thoughts?"))),i.createElement("div",{className:r(de(I))},i.createElement("div",{className:r(ue)},i.createElement(f.c,{buttonStyle:"SUBTLE",size:"SMALL",onClick:function(){return Z()}},"Cancel")),i.createElement(f.c,{buttonStyle:"STRONG",size:"SMALL",disabled:_||n,onClick:function(){return fe(s)}},"Respond")))))},be=function(e){var t=e.postId,n=i.useContext(p.a),s=n.responsesLocked,r=n.isLockedResponse,f=Boolean(Object(u.a)("enable_lock_responses")),b=i.useState(!1),g=a()(b,2),h=g[0],v=g[1];if(i.useEffect((function(){void 0!==("undefined"==typeof document?"undefined":o()(document))&&v(!0)}),[]),!h)return null;if(f&&s){var y=r?"This response belongs to a story with a closed discussion. Responding is not supported at this time.":void 0;return i.createElement(E,{message:y})}return Object(m.d)(navigator.userAgent)?i.createElement(x,{postId:t}):i.createElement(l.a,null,i.createElement(D,{postId:t},(function(e){var n=e.publishResponse,s=e.loading,o=e.error;return Object(c.a)(o)?i.createElement(E,{message:"The author has closed discussion for this story. We are unable to save changes to your response."}):i.createElement(H,null,(function(e){var o=e.saveResponse;return i.createElement(d.b,{source:{susiEntry:"respond_sidebar"},extendSource:!0},i.createElement(fe,{postId:t,isPublishingResponse:s,publishResponse:n,saveResponse:o}))}))})))}}}]);
//# sourceMappingURL=responses.editor.25f43fbe.chunk.js.map